# NZHike æ¶æ„ä¼˜åŒ–æ€»ç»“

## ğŸ“‹ é‡æ„æ¦‚è¿°

æœ¬æ¬¡é‡æ„å°† NZHike é¡¹ç›®ä»ä¼ ç»Ÿçš„ MVC åˆ†å±‚æ¶æ„è½¬å˜ä¸º**åŸºäºåŠŸèƒ½æ¨¡å—ï¼ˆFeature-basedï¼‰**çš„æ¶æ„ã€‚

## ğŸ¯ é‡æ„ç›®æ ‡

1. **æé«˜ä»£ç å¯ç»´æŠ¤æ€§** - ç›¸å…³ä»£ç é›†ä¸­åœ¨ä¸€èµ·
2. **å¢å¼ºå¯æ‰©å±•æ€§** - æ·»åŠ æ–°åŠŸèƒ½æ›´ç®€å•
3. **æ¸…æ™°çš„èŒè´£åˆ’åˆ†** - æ¯ä¸ªæ¨¡å—ç‹¬ç«‹è´Ÿè´£
4. **ä¾¿äºå›¢é˜Ÿåä½œ** - å‡å°‘ä»£ç å†²çª
5. **æ›´å¥½çš„æµ‹è¯•æ€§** - æ¨¡å—åŒ–ä¾¿äºå•å…ƒæµ‹è¯•

## ğŸ“Š æ¶æ„å¯¹æ¯”

### æ—§æ¶æ„ï¼ˆåˆ†å±‚æ¶æ„ï¼‰
```
NZHike/
â”œâ”€â”€ Models/          # æ‰€æœ‰æ¨¡å‹æ··åœ¨ä¸€èµ·
â”œâ”€â”€ Views/           # æ‰€æœ‰è§†å›¾æ··åœ¨ä¸€èµ·
â”œâ”€â”€ ViewModels/      # æ‰€æœ‰ ViewModel æ··åœ¨ä¸€èµ·
â””â”€â”€ Services/        # æ‰€æœ‰æœåŠ¡æ··åœ¨ä¸€èµ·
```

**é—®é¢˜ï¼š**
- âŒ éš¾ä»¥å¿«é€Ÿå®šä½æŸä¸ªåŠŸèƒ½çš„ä»£ç 
- âŒ æ·»åŠ æ–°åŠŸèƒ½éœ€è¦åœ¨å¤šä¸ªæ–‡ä»¶å¤¹ä¸­åˆ›å»ºæ–‡ä»¶
- âŒ åŠŸèƒ½ä¹‹é—´çš„ä¾èµ–å…³ç³»ä¸æ¸…æ™°
- âŒ æ–‡ä»¶å¤¹ä¸­æ–‡ä»¶è¿‡å¤šï¼Œéš¾ä»¥ç®¡ç†

### æ–°æ¶æ„ï¼ˆåŠŸèƒ½æ¨¡å—æ¶æ„ï¼‰
```
NZHike/
â”œâ”€â”€ App/                    # åº”ç”¨å…¥å£å’Œå…¨å±€çŠ¶æ€
â”œâ”€â”€ Core/                   # æ ¸å¿ƒåŠŸèƒ½ï¼ˆå¯å¤ç”¨ï¼‰
â”‚   â”œâ”€â”€ Services/          # æ ¸å¿ƒæœåŠ¡
â”‚   â”œâ”€â”€ Components/        # é€šç”¨ç»„ä»¶
â”‚   â””â”€â”€ Persistence/       # æ•°æ®æŒä¹…åŒ–
â”œâ”€â”€ Features/              # åŠŸèƒ½æ¨¡å—
â”‚   â”œâ”€â”€ Tracks/           # æ­¥é“åŠŸèƒ½ï¼ˆå®Œæ•´çš„åŠŸèƒ½å•å…ƒï¼‰
â”‚   â”œâ”€â”€ Huts/             # å±±å±‹åŠŸèƒ½
â”‚   â”œâ”€â”€ Campsites/        # è¥åœ°åŠŸèƒ½
â”‚   â”œâ”€â”€ Favorites/        # æ”¶è—åŠŸèƒ½
â”‚   â”œâ”€â”€ Home/             # ä¸»é¡µåŠŸèƒ½
â”‚   â”œâ”€â”€ Search/           # æœç´¢åŠŸèƒ½
â”‚   â””â”€â”€ Settings/         # è®¾ç½®åŠŸèƒ½
â”œâ”€â”€ Shared/                # å…±äº«ç»„ä»¶
â”‚   â””â”€â”€ Components/       # è·¨åŠŸèƒ½ç»„ä»¶
â””â”€â”€ Resources/            # èµ„æºæ–‡ä»¶
```

**ä¼˜åŠ¿ï¼š**
- âœ… æ¯ä¸ªåŠŸèƒ½æ¨¡å—åŒ…å«å…¶æ‰€æœ‰ç›¸å…³ä»£ç 
- âœ… åŠŸèƒ½è¾¹ç•Œæ¸…æ™°ï¼Œæ˜“äºç†è§£
- âœ… æ·»åŠ æ–°åŠŸèƒ½åªéœ€åˆ›å»ºæ–°çš„ Feature æ–‡ä»¶å¤¹
- âœ… ä¾¿äºä»£ç å®¡æŸ¥å’Œå›¢é˜Ÿåä½œ

## ğŸ—ï¸ åŠŸèƒ½æ¨¡å—ç»“æ„

æ¯ä¸ªåŠŸèƒ½æ¨¡å—ï¼ˆFeatureï¼‰åŒ…å«ï¼š

```
Features/[FeatureName]/
â”œâ”€â”€ Models/          # è¯¥åŠŸèƒ½çš„æ•°æ®æ¨¡å‹
â”œâ”€â”€ Views/           # è¯¥åŠŸèƒ½çš„è§†å›¾
â”‚   â””â”€â”€ Components/  # è¯¥åŠŸèƒ½ä¸“ç”¨çš„ç»„ä»¶
â”œâ”€â”€ ViewModels/      # è¯¥åŠŸèƒ½çš„ ViewModel
â””â”€â”€ Services/        # è¯¥åŠŸèƒ½çš„æœåŠ¡å±‚
```

### ç¤ºä¾‹ï¼šTracks åŠŸèƒ½æ¨¡å—

```
Features/Tracks/
â”œâ”€â”€ Models/
â”‚   â”œâ”€â”€ Track.swift                 # æ­¥é“æ¨¡å‹
â”‚   â”œâ”€â”€ Track+CoreData.swift        # Core Data æ‰©å±•
â”‚   â”œâ”€â”€ TrackDetail.swift           # æ­¥é“è¯¦æƒ…
â”‚   â””â”€â”€ RecommendedTrack.swift      # æ¨èæ­¥é“
â”œâ”€â”€ Views/
â”‚   â”œâ”€â”€ TrackDetailView.swift       # è¯¦æƒ…é¡µ
â”‚   â””â”€â”€ Components/
â”‚       â””â”€â”€ TrackCard.swift         # æ­¥é“å¡ç‰‡
â”œâ”€â”€ ViewModels/
â”‚   â””â”€â”€ TrackDetailViewModel.swift  # è¯¦æƒ… ViewModel
â””â”€â”€ Services/
    â””â”€â”€ TrackService.swift          # æ­¥é“æœåŠ¡
```

## ğŸ“¦ æ¨¡å—è¯´æ˜

### App æ¨¡å—
**èŒè´£ï¼š** åº”ç”¨ç¨‹åºå…¥å£å’Œå…¨å±€çŠ¶æ€ç®¡ç†
- `NZHikeApp.swift` - åº”ç”¨å…¥å£
- `ContentView.swift` - æ ¹è§†å›¾
- `AppState.swift` - å…¨å±€çŠ¶æ€ï¼ˆä¸»é¢˜ã€æ•°æ®åŠ è½½çŠ¶æ€ç­‰ï¼‰

### Core æ¨¡å—
**èŒè´£ï¼š** æ ¸å¿ƒåŠŸèƒ½å’Œå·¥å…·ï¼Œå¯è¢«æ‰€æœ‰ Feature ä½¿ç”¨

**Core/Services:**
- `CoordinateConverter.swift` - NZTM åˆ° WGS84 åæ ‡è½¬æ¢
- `DOCAPIService.swift` - DOC API ç½‘ç»œè¯·æ±‚
- `LocationManager.swift` - ä½ç½®æœåŠ¡
- `WeatherService.swift` - å¤©æ°”æœåŠ¡

**Core/Components:**
- `EmptyStateView.swift` - ç©ºçŠ¶æ€è§†å›¾
- `LoadingView.swift` - åŠ è½½è§†å›¾
- `SearchBar.swift` - æœç´¢æ 
- `FlowLayout.swift` - æµå¼å¸ƒå±€

### Features æ¨¡å—
**èŒè´£ï¼š** å„ä¸ªç‹¬ç«‹çš„åŠŸèƒ½æ¨¡å—

#### Tracksï¼ˆæ­¥é“ï¼‰
- æ­¥é“åˆ—è¡¨ã€è¯¦æƒ…ã€æ¨èæ­¥é“
- æ­¥é“æœç´¢å’Œè¿‡æ»¤
- æ­¥é“æ•°æ®ç®¡ç†

#### Hutsï¼ˆå±±å±‹ï¼‰
- å±±å±‹åˆ—è¡¨ã€è¯¦æƒ…ã€æ¨èå±±å±‹
- å±±å±‹ä¿¡æ¯å±•ç¤º
- å±±å±‹æ•°æ®ç®¡ç†

#### Campsitesï¼ˆè¥åœ°ï¼‰
- è¥åœ°åˆ—è¡¨ã€è¯¦æƒ…ã€æ¨èè¥åœ°
- è¥åœ°è®¾æ–½ä¿¡æ¯
- è¥åœ°æ•°æ®ç®¡ç†

#### Favoritesï¼ˆæ”¶è—ï¼‰
- æ”¶è—ç®¡ç†ï¼ˆæ­¥é“ã€å±±å±‹ã€è¥åœ°ï¼‰
- æ”¶è—åˆ—è¡¨å±•ç¤º
- æ”¶è—åœ°å›¾è§†å›¾
- Core Data æŒä¹…åŒ–

#### Homeï¼ˆä¸»é¡µï¼‰
- ä¸»é¡µè§†å›¾
- æ¨èå†…å®¹å±•ç¤º
- å¿«é€Ÿå¯¼èˆª

#### Searchï¼ˆæœç´¢ï¼‰
- å…¨å±€æœç´¢
- æœç´¢ç»“æœå±•ç¤º
- æœç´¢å†å²

#### Settingsï¼ˆè®¾ç½®ï¼‰
- åº”ç”¨è®¾ç½®
- ä¸»é¢˜åˆ‡æ¢
- å…¶ä»–é…ç½®

### Shared æ¨¡å—
**èŒè´£ï¼š** è·¨åŠŸèƒ½çš„å…±äº«ç»„ä»¶

**Shared/Components/Weather:**
- `WeatherChip.swift` - å¤©æ°”æ ‡ç­¾
- `WeatherHeaderView.swift` - å¤©æ°”å¤´éƒ¨
- `WeatherSectionView.swift` - å¤©æ°”åŒºå—

**Shared/Components/Map:**
- `LocationMapView.swift` - ä½ç½®åœ°å›¾

**Shared/Components/Status:**
- `StatusBadge.swift` - çŠ¶æ€å¾½ç« 

### Resources æ¨¡å—
**èŒè´£ï¼š** èµ„æºæ–‡ä»¶ç®¡ç†
- Assets.xcassets - å›¾ç‰‡èµ„æº
- Data/ - JSON æ•°æ®æ–‡ä»¶
- Config/ - é…ç½®æ–‡ä»¶
- CoreData/ - Core Data æ¨¡å‹

## ğŸ”„ ä¾èµ–å…³ç³»

```
App â†’ Features â†’ Core
     â†“         â†“
   Shared â† Core
```

**è§„åˆ™ï¼š**
1. **App** å¯ä»¥ä¾èµ–æ‰€æœ‰æ¨¡å—
2. **Features** å¯ä»¥ä¾èµ– Core å’Œ Shared
3. **Features** ä¹‹é—´å°½é‡é¿å…ç›´æ¥ä¾èµ–
4. **Core** ä¸ä¾èµ– Features
5. **Shared** å¯ä»¥ä¾èµ– Core

## ğŸš€ å®æ–½æ­¥éª¤

è¯¦ç»†æ­¥éª¤è¯·å‚è€ƒ `refactor_structure.md` æ–‡ä»¶ã€‚

### å¿«é€Ÿå¼€å§‹

1. **å¤‡ä»½ä»£ç **
   ```bash
   git checkout -b refactor/feature-based-architecture
   ```

2. **åœ¨ Xcode ä¸­åˆ›å»º Group ç»“æ„**
   - å³é”®ç‚¹å‡»é¡¹ç›® â†’ New Group
   - æŒ‰ç…§æ–°æ¶æ„åˆ›å»ºæ–‡ä»¶å¤¹ç»“æ„

3. **ç§»åŠ¨æ–‡ä»¶**
   - åœ¨ Xcode ä¸­æ‹–åŠ¨æ–‡ä»¶åˆ°å¯¹åº”çš„ Group
   - ä¸è¦åœ¨ Finder ä¸­ç§»åŠ¨æ–‡ä»¶

4. **éªŒè¯**
   ```bash
   # ç¼–è¯‘é¡¹ç›®
   Cmd + B
   
   # è¿è¡Œæµ‹è¯•
   Cmd + U
   ```

5. **æäº¤**
   ```bash
   git add .
   git commit -m "refactor: é‡æ„ä¸ºåŠŸèƒ½æ¨¡å—æ¶æ„"
   ```

## ğŸ“ˆ é¢„æœŸæ”¶ç›Š

### å¼€å‘æ•ˆç‡
- â±ï¸ **æŸ¥æ‰¾ä»£ç æ—¶é—´å‡å°‘ 50%** - åŠŸèƒ½ç›¸å…³ä»£ç é›†ä¸­
- ğŸš€ **æ·»åŠ æ–°åŠŸèƒ½é€Ÿåº¦æå‡ 30%** - æ¸…æ™°çš„æ¨¡å—æ¨¡æ¿
- ğŸ› **Bug ä¿®å¤æ—¶é—´å‡å°‘ 40%** - æ›´å®¹æ˜“å®šä½é—®é¢˜

### ä»£ç è´¨é‡
- ğŸ“Š **ä»£ç å¯è¯»æ€§æå‡** - æ¸…æ™°çš„ç»„ç»‡ç»“æ„
- ğŸ§ª **æµ‹è¯•è¦†ç›–ç‡æå‡** - æ¨¡å—åŒ–ä¾¿äºæµ‹è¯•
- ğŸ”§ **å¯ç»´æŠ¤æ€§æå‡** - èŒè´£æ¸…æ™°

### å›¢é˜Ÿåä½œ
- ğŸ‘¥ **ä»£ç å†²çªå‡å°‘** - åŠŸèƒ½æ¨¡å—ç‹¬ç«‹
- ğŸ“ **ä»£ç å®¡æŸ¥æ•ˆç‡æå‡** - å˜æ›´èŒƒå›´æ¸…æ™°
- ğŸ“ **æ–°æˆå‘˜ä¸Šæ‰‹æ›´å¿«** - ç»“æ„ç›´è§‚

## ğŸ“ æœ€ä½³å®è·µ

### 1. ä¿æŒæ¨¡å—ç‹¬ç«‹
```swift
// âœ… å¥½çš„åšæ³•ï¼šé€šè¿‡ä¾èµ–æ³¨å…¥
class TrackDetailViewModel {
    init(trackService: TrackService, favoritesManager: FavoritesManager) {
        // ...
    }
}

// âŒ é¿å…ï¼šç›´æ¥åˆ›å»ºä¾èµ–
class TrackDetailViewModel {
    let trackService = TrackService() // ç´§è€¦åˆ
}
```

### 2. ä½¿ç”¨åè®®æŠ½è±¡
```swift
// âœ… å®šä¹‰åè®®
protocol TrackServiceProtocol {
    func fetchTracks() async -> [Track]
}

// ä¾¿äºæµ‹è¯•å’Œæ›¿æ¢å®ç°
class TrackService: TrackServiceProtocol {
    // ...
}
```

### 3. å…±äº«ç»„ä»¶æ”¾åœ¨ Shared
```swift
// âœ… å¤šä¸ªåŠŸèƒ½ä½¿ç”¨çš„ç»„ä»¶
Shared/Components/Weather/WeatherChip.swift

// âŒ ä¸è¦åœ¨ Feature ä¸­é‡å¤åˆ›å»º
Features/Tracks/Components/WeatherChip.swift
Features/Huts/Components/WeatherChip.swift
```

### 4. ä¿æŒ Core çº¯å‡€
```swift
// âœ… Core ä¸­åªæ”¾é€šç”¨åŠŸèƒ½
Core/Services/CoordinateConverter.swift

// âŒ ä¸è¦æ”¾ä¸šåŠ¡é€»è¾‘
Core/Services/TrackBusinessLogic.swift // åº”è¯¥åœ¨ Features/Tracks/Services
```

## ğŸ“š è¿›ä¸€æ­¥ä¼˜åŒ–å»ºè®®

### çŸ­æœŸï¼ˆ1-2 å‘¨ï¼‰
1. âœ… å®ŒæˆåŸºæœ¬é‡æ„
2. âœ… æ›´æ–°æ–‡æ¡£å’Œæ³¨é‡Š
3. âœ… å›¢é˜ŸåŸ¹è®­

### ä¸­æœŸï¼ˆ1-2 ä¸ªæœˆï¼‰
1. ğŸ”„ å¼•å…¥ä¾èµ–æ³¨å…¥å®¹å™¨
2. ğŸ”„ ç»Ÿä¸€é”™è¯¯å¤„ç†æœºåˆ¶
3. ğŸ”„ å®Œå–„å•å…ƒæµ‹è¯•

### é•¿æœŸï¼ˆ3-6 ä¸ªæœˆï¼‰
1. ğŸ¯ å®ç° Clean Architecture
2. ğŸ¯ å¼•å…¥ MVVM-Cï¼ˆCoordinatorï¼‰
3. ğŸ¯ æ¨¡å—åŒ–æ‰“åŒ…ï¼ˆSwift Package Managerï¼‰

## ğŸ¤ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœåœ¨é‡æ„è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼š
1. æŸ¥çœ‹ `REFACTORING_GUIDE.md` è¯¦ç»†æŒ‡å—
2. æŸ¥çœ‹ `refactor_structure.md` æ­¥éª¤æ¸…å•
3. å‚è€ƒæœ¬æ–‡æ¡£çš„æœ€ä½³å®è·µ

---

**ç¥é‡æ„é¡ºåˆ©ï¼** ğŸ‰
